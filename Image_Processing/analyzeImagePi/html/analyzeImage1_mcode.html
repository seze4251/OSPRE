<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">%% Anthony Torres</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% OSPRE</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% analyzeImage.m</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% Created: 1/13/17</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% Modified: 1/13/17</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">function</span>[<span class="var type1" id="S2T1U3">centerPt</span>, <span class="var type1" id="S3T2U4">radius</span>, <span class="var type1" id="S4T2U5">numCirc</span>, <span class="var type1" id="S5T2U6">alpha</span>, <span class="var type1" id="S6T2U7">beta</span>, <span class="var type1" id="S7T2U8">theta</span>] = analyzeImage(<span class="var type1" id="S8T3U11">imIn</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">          <span class="var type1" id="S9T4U12">radiusRangeGuess</span>, <span class="var type1" id="S10T2U13">sensVal</span>, <span class="var type1" id="S11T4U14">pxDeg</span>, <span class="var type1" id="S12T2U15">imgWidth</span>, <span class="var type1" id="S13T2U16">imgHeight</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">%% Set up eval variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T2:U13"><span class="var type1" id="S14T2U19">xCenter</span> = <span class="mxinfo  dbl" id="T2:U15"><span class="var type1 dbl" id="S12T2U21">imgWidth</span>/<span class="mxinfo " id="T2:U17">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T2:U18"><span class="var type1" id="S15T2U25">yCenter</span> = <span class="mxinfo  dbl" id="T2:U20"><span class="var type1 dbl" id="S13T2U27">imgHeight</span>/<span class="mxinfo " id="T2:U22">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T2:U23"><span class="var type1" id="S16T2U31">avgPxDeg</span> = <span class="mxinfo  dbl" id="T2:U25">mean(<span class="var type1" id="S11T4U34">pxDeg</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">%% Preprocessing section</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T5:U27"><span class="var type1" id="S18T5U37">im</span> = <span class="mxinfo  dbl" id="T5:U29">rgb2gray(<span class="var type1" id="S8T3U40">imIn</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="comment">% Convert to BW, hreshold, and fill image</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T6:U31"><span class="var type1" id="S20T6U43">bw</span> = <span class="mxinfo  dbl" id="T6:U33">imfill(<span class="mxinfo  dbl" id="T6:U34">imbinarize(<span class="var type1" id="S18T5U48">im</span>)</span>,<span class="string">'holes'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="comment">%% Analyze image to find center point and radius</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">% Find circle fit through CHT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">[<span class="var type1 dbl" id="S23T7U53">centers</span>, <span class="var type1 dbl" id="S24T7U54">radii</span>] = imfindcircles(<span class="var type1" id="S20T6U57">bw</span>, <span class="var type1 dbl" id="S9T4U58">radiusRangeGuess</span>, <span class="string">'Sensitivity'</span>, <span class="var type1 dbl" id="S10T2U60">sensVal</span>, <span class="string">'ObjectPolarity'</span>, <span class="string">'bright'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="comment">%% Check for valid find</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="keyword">if</span>(isempty(<span class="var type1" id="S23T7U68">centers</span>))</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">    <span class="comment">%warning('No centers!')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo  dbl" id="T1:U42"><span class="var type1 dbl" id="S2T1U71">centerPt</span> = <span class="mxinfo  dbl" id="T2:U44">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo  dbl" id="T2:U45"><span class="var type1 dbl" id="S3T2U76">radius</span> = <span class="mxinfo  dbl" id="T2:U47">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo  dbl" id="T2:U48"><span class="var type1 dbl" id="S4T2U81">numCirc</span> = <span class="mxinfo  dbl" id="T2:U50">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo  dbl" id="T2:U51"><span class="var type1 dbl" id="S5T2U86">alpha</span> = <span class="mxinfo  dbl" id="T2:U53">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo  dbl" id="T2:U54"><span class="var type1 dbl" id="S6T2U91">beta</span> = <span class="mxinfo  dbl" id="T2:U56">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo  dbl" id="T2:U57"><span class="var type1 dbl" id="S7T2U96">theta</span> = <span class="mxinfo  dbl" id="T2:U59">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="comment">%% Return found information</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo  dbl" id="T1:U60"><span class="var type1 dbl" id="S2T1U102">centerPt</span> = <span class="mxinfo  dbl" id="T4:U62">[<span class="mxinfo  dbl" id="T2:U63"><span class="var type1 dbl" id="S23T7U106">centers</span>(<span class="mxinfo " id="T2:U65">1</span>)</span> <span class="mxinfo  dbl" id="T2:U66"><span class="var type1 dbl" id="S23T7U109">centers</span>(<span class="mxinfo " id="T2:U68">2</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo  dbl" id="T2:U69"><span class="var type1" id="S5T2U113">alpha</span> = <span class="mxinfo  dbl" id="T2:U71">(<span class="mxinfo  dbl" id="T2:U72"><span class="mxinfo  dbl" id="T2:U73"><span class="var type1" id="S23T7U118">centers</span>(<span class="mxinfo " id="T2:U75">1</span>)</span> - <span class="var type1" id="S14T2U120">xCenter</span></span>)/<span class="mxinfo  dbl" id="T2:U77"><span class="var type1 dbl" id="S11T4U122">pxDeg</span>(<span class="mxinfo " id="T8:U79">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo  dbl" id="T2:U80"><span class="var type1" id="S6T2U126">beta</span> = <span class="mxinfo  dbl" id="T2:U82">(<span class="mxinfo  dbl" id="T2:U83"><span class="mxinfo  dbl" id="T2:U84"><span class="var type1" id="S23T7U131">centers</span>(<span class="mxinfo " id="T2:U86">2</span>)</span> - <span class="var type1" id="S15T2U133">yCenter</span></span>)/<span class="mxinfo  dbl" id="T2:U88"><span class="var type1 dbl" id="S11T4U135">pxDeg</span>(<span class="mxinfo " id="T8:U90">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo  dbl" id="T2:U91"><span class="var type1 dbl" id="S3T2U139">radius</span> = <span class="mxinfo  dbl" id="T2:U93"><span class="var type1" id="S24T7U141">radii</span>(<span class="mxinfo " id="T2:U95">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo  dbl" id="T2:U96"><span class="var type1" id="S7T2U145">theta</span> = <span class="mxinfo  dbl" id="T2:U98"><span class="mxinfo  dbl" id="T2:U99"><span class="mxinfo  dbl" id="T2:U100">2</span>*<span class="var type1" id="S3T2U149">radius</span></span>/<span class="var type1" id="S16T2U150">avgPxDeg</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo  dbl" id="T2:U103"><span class="var type1" id="S4T2U153">numCirc</span> = <span class="mxinfo  dbl" id="T2:U105">length(<span class="var type1" id="S24T7U156">radii</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
